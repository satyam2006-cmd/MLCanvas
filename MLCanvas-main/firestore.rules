/**
 * # Core Philosophy
 * This ruleset enforces a strict user-ownership model for an ML Studio platform.
 * All data, including datasets, models, and experiments, is private to the user
 * who created it. Access is granted only to authenticated users for their own data.
 * The default security posture is to deny all access unless explicitly permitted.
 *
 * # Data Structure
 * All user-specific data is hierarchically organized under the path `/users/{userId}`.
 * This structure creates a clear and secure data boundary for each user, simplifying
 * security rules by leveraging path-based authorization.
 *   - `/users/{userId}`: Stores the user's public profile.
 *   - `/users/{userId}/datasets/{datasetId}`: Stores datasets owned by the user.
 *   - `/users/{userId}/models/{modelId}`: Stores models trained by the user.
 *   - `/users/{userId}/experiments/{experimentId}`: Stores experiments created by the user.
 *
 * # Key Security Decisions
 * - **No Public Access**: All collections and documents require user authentication.
 * - **No User Listing**: Listing the top-level `/users` collection is strictly forbidden
 *   to protect user privacy and prevent enumeration attacks.
 * - **Strict Ownership**: A user can only read, write, and delete their own documents.
 *   There are no shared or collaborative features in this model.
 * - **Prototyping Flexibility**: While authorization is strict, data validation is
 *   minimal. Rules do not enforce specific data types or fields beyond what is
 *   necessary for authorization, allowing for rapid front-end development.
 *
 * # Denormalization for Authorization
 * Each document in the user-specific subcollections (datasets, models, experiments)
 * contains a denormalized `userId` field. This design choice is critical for:
 * 1. **Performance**: It avoids slow and costly `get()` calls to parent documents.
 * 2. **Integrity**: Rules enforce that this `userId` field matches the user's ID
 *    upon creation and remains immutable, ensuring a document can never be
 *    disassociated from its owner or the path it resides in.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
